<div>
  <h1 class="page-title">Broiler Purchases</h1>
  <app-filter-card-purchases
    [purchases]="purchases"
    (alteredPurchaseList)="onSearch($event)"
  ></app-filter-card-purchases>
  <table class="user-table" matSort (matSortChange)="sortData($event)">
    <tr>
      <th mat-sort-header="givenName"><div class="header-cell">First Name</div></th>
      <th mat-sort-header="surname"><div class="header-cell">Last Name</div></th>
      <th mat-sort-header="date"><div class="header-cell">Created At</div></th>
      <th mat-sort-header="products"><div class="header-cell">Products</div></th>
      <th mat-sort-header="paid"><div class="header-cell header-cell-small">Paid</div></th>
      <th mat-sort-header="price"><div class="header-cell header-cell-small">Price</div></th>
      <th mat-sort-header="actions"><div class="header-cell header-cell-small">Actions</div></th>
    </tr>

    <tr
      appEditPurchase
      [isNewPurchase]="true"
      [purchase]="emptyPurchase"
      [users]="users"
      [foodOptions]="foodOptions"
      (isExited)="onCancelEdit()"
      (isSaved)="initializePurchases()"
    ></tr>

    @for (purchase of filteredPurchases; track $index) { @if (currentlyEditingId ==
    purchase.purchaseId) {
    <tr
      appEditPurchase
      [isNewPurchase]="false"
      [purchase]="purchase"
      [users]="users"
      [foodOptions]="foodOptions"
      (isExited)="onCancelEdit()"
      (isSaved)="initializePurchases()"
    ></tr>
    } @else {
    <tr>
      <td>
        <div class="givenName-container">
          <div
            class="{{ purchase.paid ? 'paid-indicator-paid' : 'paid-indicator-not-paid' }}"
          ></div>
          {{ purchase.givenName }}
        </div>
      </td>
      <td>{{ purchase.surname }}</td>
      <td>{{ purchase.date }}</td>
      <td>
        @for (type of purchase.products; track $index) {
        <div>{{ type }}</div>
        }
      </td>
      <td>
        <mat-dialog-content class="checkbox">
          <mat-checkbox [checked]="purchase.paid" (change)="onPaidChange(purchase)" />
        </mat-dialog-content>
      </td>
      <td>{{ purchase.price }} â‚¬</td>
      <td>
        <mat-icon (click)="onEdit(purchase.purchaseId!)" class="edit-icon">edit</mat-icon>
      </td>
    </tr>
    } }
  </table>
</div>
